name: GitLab → GitHub Migration (Sample Tokens)

on:
  workflow_dispatch:  # Manual trigger from Actions tab

jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - name: Install tools
        run: |
          sudo apt-get update -y
          sudo apt-get install -y jq curl
          git --version

      - name: Clone from GitLab (mirror)
        run: |
          set -euo pipefail
          WORKDIR=/tmp/repo-migration
          mkdir -p "${WORKDIR}"
          cd "${WORKDIR}"

          # ✅ Replace these sample tokens with your real ones
          GITLAB_TOKEN="glpat-BY2vluatLoXJwOqGljSXc286MQp1Omo3Mml5Cw.01.1217cfwep"
          GITHUB_TOKEN="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"

          # ✅ Replace these with your actual repo paths
          GITLAB_PROJECT="prakashguruswamy24-group/my_project"
          GITHUB_OWNER="prakashhg"
          GITHUB_REPO="my_project"

          # Build GitLab HTTPS URL with PAT
          SRC_URL="https://oauth2:${GITLAB_TOKEN}@gitlab.com/${GITLAB_PROJECT}.git"
          echo "Cloning --mirror from GitLab..."
          git clone --mirror "${SRC_URL}" src.git

          echo "Preview refs:"
          git -C src.git show-ref | head -n 10 || true

      - name: Push mirror to GitHub
        run: |
          set -euo pipefail
          cd /tmp/repo-migration/src.git

          # ✅ Replace with your GitHub PAT
          GITHUB_TOKEN="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"
          GITHUB_OWNER="prakashhg"
          GITHUB_REPO="my_project"

          PUSH_URL="https://x-access-token:${GITHUB_TOKEN}@github.com/${GITHUB_OWNER}/${GITHUB_REPO}.git"
          git remote remove github 2>/dev/null || true
          git remote add github "${PUSH_URL}"
          echo "Pushing --          echo "Pushing --mirror to GitHub..."
          git push --mirror github
