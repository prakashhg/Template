
name: GitLab → GitHub Migration (Main)

on:
  workflow_dispatch:
    inputs:
      gl_url:         { description: "GitLab base URL", required: true, type: string }
      gl_project:     { description: "GitLab project path", required: true, type: string }
      gh_owner:       { description: "GitHub owner/org",    required: true, type: string }
      gh_repo:        { description: "GitHub repo name",    required: true, type: string }
      auto_create:    { description: "Create destination?", required: true, type: boolean, default: true }
      delete_first:   { description: "Delete dest repo first?", required: true, type: boolean, default: false }
      migrate_mrs:    { description: "Migrate MRs → PRs?", required: true, type: boolean, default: true }

jobs:
  commit-sync:
    uses: ./.github/workflows/commit_sync.yml
    with:
      gl_url:     ${{ inputs.gl_url }}
      gl_project: ${{ inputs.gl_project }}
      gh_owner:   ${{ inputs.gh_owner }}
      gh_repo:    ${{ inputs.gh_repo }}
      auto_create:${{ inputs.auto_create }}
      delete_first:${{ inputs.delete_first }}
    secrets: inherit

  tag-sync:
    needs: commit-sync
    uses: ./.github/workflows/tag_sync.yml
    with:
      gl_url:     ${{ inputs.gl_url }}
      gl_project: ${{ inputs.gl_project }}
      gh_owner:   ${{ inputs.gh_owner }}
      gh_repo:    ${{ inputs.gh_repo }}
    secrets: inherit

  label-sync:
    needs: commit-sync
    uses: ./.github/workflows/label_sync.yml
    with:
      gl_url:     ${{ inputs.gl_url }}
      gl_project: ${{ inputs.gl_project }}
      gh_owner:   ${{ inputs.gh_owner }}
      gh_repo:    ${{ inputs.gh_repo }}
    secrets: inherit

  milestone-sync:
    needs: [commit-sync, label-sync]
    uses: ./.github/workflows/milestone_sync.yml
    with:
      gl_url:     ${{ inputs.gl_url }}
      gl_project: ${{ inputs.gl_project }}
      gh_owner:   ${{ inputs.gh_owner }}
      gh_repo:    ${{ inputs.gh_repo }}
    secrets: inherit

  pr-sync:
    if: ${{ inputs.migrate_mrs }}
    needs: commit-sync
    uses: ./.github/workflows/pr_sync.yml
    with:
      gl_url:     ${{ inputs.gl_url }}
      gl_project: ${{ inputs.gl_project }}
      gh_owner:   ${{ inputs.gh_owner }}
      gh_repo:    ${{ inputs.gh_repo }}
    secrets: inherit
