name: Migrate GitLab CI to GitHub Actions

on:

  workflow_dispatch:

    inputs:

      commit_result:

        description: "Commit converted workflow to repo"

        required: true

        default: "true"



jobs:

  migrate:

    runs-on: ubuntu-latest



    permissions:

      contents: write



    steps:

      - name: Checkout repository

        uses: actions/checkout@v4



      - name: Install GitHub CLI

        uses: cli/cli@v2



      - name: Install GitHub Actions Importer

        run: |

          gh extension install github/gh-actions-importer



      - name: Authenticate GitHub CLI

        run: |

          echo "${{ secrets.GH_PAT }}" | gh auth login --with-token



      - name: Verify GitLab CI file exists

        run: |

          if [ ! -f ".gitlab-ci.yml" ]; then

            echo "❌ .gitlab-ci.yml not found"

            exit 1

          fi

          echo "✅ Found .gitlab-ci.yml"



      - name: Convert GitLab CI to GitHub Actions

        run: |

          gh actions-importer migrate gitlab \

            --input .gitlab-ci.yml \

            --output .github/workflows \

            --gitlab-access-token "${{ secrets.GITLAB_TOKEN }}" \

            --gitlab-server-url "https://${{ secrets.GITLAB_HOST }}"



      - name: List converted workflows

        run: |

          echo "Generated workflows:"

          ls -la .github/workflows



      - name: Commit converted workflow

        if: ${{ github.event.inputs.commit_result == 'true' }}

        run: |

          git config user.name "github-actions"

          git config user.email "github-actions@github.com"



          git add .github/workflows

          git commit -m "chore: migrate GitLab CI to GitHub Actions"

          git push
